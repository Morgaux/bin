#!/bin/sh
# shellcheck disable=SC2068

#
# dmenu based browser searcher / launcher
#

for dependancy in dmenu surf
do
	if [ -x "$(command -v "$dependancy")" ]
	then
		continue
	fi

	echo "$(basename "$0"): error: $dependancy is not installed." 1>&2
	exit 1
done

SELF="$(basename "$0")"
HISTFILE="${HOME}/.${SELF}.hist"

case "$SELF" in
	"dyt")
		URL="https://www.youtube.com/results?search_query=";;
	*)
		URL="http://duckduckgo.com/?q=";;
esac

SEARCH="$(uniq -i < "$HISTFILE" | \
	awk '{a[i++]=$0} END {for (j=i-1; j>=0;) print a[j--] }' | \
	dmenu -l 100 -p "${SELF}:" $@)"

case "$SEARCH" in
	"")
		exit 1 ;; # nothing selected
	*"://"*)
		surf "$(echo "$SEARCH"     | \
			tee -a "$HISTFILE" | \
			sed 's/ /%20/g')" ;; # direct URL
	*)
		surf "${URL}$(echo "$SEARCH" | \
			tee -a "$HISTFILE"   | \
			sed 's/ /%20/g')" ;; # search term
esac

