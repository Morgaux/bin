#!/bin/sh
#http://gitlab.com/morgaux/bin

#
# print message to stderr
#

[ $# -gt 0 ] && ERRMSG="$@" || ERRMSG="generic error"
PARENT="$(ps -o comm= $PPID)"

echo "$PARENT: $ERRMSG" 1>&2

if ps hf -opid,cmd -C "$$" 2>&1 1>/dev/null ; then
	TRACE="$(ps hf -opid,cmd -C "$$" | awk '$2 !~ /^[|\\]/ { print $1 }' | xargs -L 1 ps -o comm= | awk '{printf "%s"" > ",$0}' | sed 's/ > err > xargs > awk > sed > ps >//g')"
else
	TRACE="Error trace"
fi

log "$TRACE: $ERRMSG"

exit 1

